# Glob3D API Documentation

## Graphql Types

### User
|Field|Type|Description|
|-----|----|-----------|
|_id|ID|User ID generated by Mongo|
|email|String|User's email, must be unique|
|password|String|User's password, must be 10 or more characters long|
|name|String|User's name to be displayed on blogs and comments|
|date|String|Date that the user signed up on|
|position|[Int]|Position of the user in the world|

### Blog
|Field|Type|Description|
|-----|----|-----------|
|_id|ID|Blog ID generated by Mongo|
|title|String|Title of the blog|
|content|String|Content of the blog|
|author|User|Author of the blog|
|date|String|Date that the blog was created on|
|position|[Int]|Position of the blog in the world|

### Comment
|Field|Type|Description|
|-----|----|-----------|
|_id|ID|Comment ID generated by Mongo|
|user|User|User that posted the comment|
|blog|Blog|Blog that the comment is posted on|
|content|String|Content of the comment|
|date|String|Date that the comment was posted on|

### Like
|Field|Type|Description|
|-----|----|-----------|
|user|User|User that liked the blog|
|blog|Blog|Blog that was liked|
|date|String|Date that user liked the blog on|
**Note:** Likes are uniquely identified by the user and blog ID

### Follow
|Field|Type|Description|
|-----|----|-----------|
|follower|User|User that is following|
|followed|User|User that is being followed|
|date|String|Date that the following started|
**Note:** Follows are uniquely identified by the follower and followed ID

### World
|Field|Type|Description|
|-----|----|-----------|
|terrain|[[Int]]|2D array (NxN matrix) storing the current terrain types of the world|
|size|Int|Size of the world: N^2 for an NxN matrix|

## Graphql Query Endpoints

**Note:** All graphql requests go through path /graphql with POST method 

### users
- Description:
    - retrieve at most 20 users
    - optionally specify userId to retrieve a specific user.
- Parameters:
    - first: (Int) First :first number of users, :first <= 20, :first > 0
    - after: (Int) Skip :after number of users, :after >= 0
    - [Optional] userId: (String) Get the specific user with ID :userId
- Response:
    - Type: [User]
    - If userId is specified, response array can have at most 1 User
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { users(first: 20, after: 0) { _id name email } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### signin
- Description:
    - log in as a user
- Parameters:
    - email: (String) email of user
    - password: (String) password of user
- Response:
    - Type: User
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { signin(email:\"test@mail.com\", password:\"password123\") { _id } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### signout
- Description:
    - log out of a user
- Parameters: None
- Response:
    - Type: Boolean
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { signout }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### getUserPosition
- Description:
    - retrieve the signed-in user's current position
- Parameters: None
- Response:
    - Type: [Int]
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { getUserPosition }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### blogs
- Description:
    - retrieve at most 20 blogs
    - optionally specify blogId to retrieve a specific blog
    - optionally specify authorId to retrieve blogs from a specific user
- Parameters:
    - first: (Int) First :first number of blogs, :first <= 20, :first > 0
    - after: (Int) Skip :after number of blogs, :after >= 0
    - [Optional] blogId: (String) Get the specific blog with ID :blogId
    - [Optional] authorId: (String) Get the blogs from the specific user with ID :authorId
- Response:
    - Type: [Blog]
    - If blogId is specified, response array can have at most 1 blog
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { blogs(first: 20, after: 0, authorId: \"606a0e03450fd22868114e5a\") { _id title content } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### numBlogs
- Description:
    - retrieve the number of blogs
    - optionally specify authorId to retrieve number of blogs from a specific user
- Parameters:
    - [Optional] authorId: (String) Get the number of blogs from the specific user with ID :authorId
- Response:
    - Type: Int
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { numBlogs(authorId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### blogsNearUser
- Description:
    - retrieve at most 20 blogs near the logged-in user
    - optionally specify long poll to only get the response back when the user's position updates, or timesout after a minute
- Parameters:
    - limit: (Int) Get at most :limit number of blogs, :limit <= 20 and :limit >= 0
    - [Optional] long: (Boolean) long poll iff true
- Response:
    - Type: [Blog]
    - If long is true and long poll times out after a min, null is returned
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { blogsNearUser(limit: 20, long: true) { _id title content } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### comments
- Description:
    - retrieve at most 20 comments
    - optionally specify commentId to retrieve a specific comment
    - optionally specify userId to retrieve the comments from a specific user
    - optionally specify blogId to retrieve the comments for a specific blog
- Parameters:
    - first: (Int) First :first number of comments, :first <= 20, :first > 0
    - after: (Int) Skip :after number of comments, :after >= 0
    - [Optional] commentId: (String) Get the specific comment with ID :commentId
    - [Optional] userId: (String) Get the comments from the specific user with ID :userId
    - [Optional] blogId: (String) Get the comments for the specific blog with ID :blogId
- Response:
    - Type: [Comment]
    - If commentId is specified, the response array can have at most 1 comment
- Example
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { comments(first: 20, after: 0, blogId: \"606a0e03450fd22868114e5a\") { _id content } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### numComments
- Description:
    - retrieve the number of comments
    - optionally specify userId to retrieve the number of comments from a specific user
    - optionally specify blogId to retrieve the number of comments for a specific blog
- Parameters:
    - [Optional] userId: (String) Get the number of comments from the specific user with ID :userId
    - [Optional] blogId: (String) Get the number of comments for the specific blog with ID :blogId
- Response:
    - Type: Int
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { numComments(blogId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### likes
- Description:
    - retrieve at most 20 likes
    - optionally specify userId to retrieve the likes made by a specific user
    - optionally specify blogId to retrieve the likes on a specific blog
- Parameters:
    - first: (Int) First :first number of likes, :first <= 20, :first > 0
    - after: (Int) Skip :after number of likes, :after >= 0
    - [Optional] userId: (String) Get the likes from the specific user with ID :userId
    - [Optional] blogId: (String) Get the likes for the specific blog with ID :blogId
- Response:
    - Type: [Like]
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { likes(first: 20, after: 0, blogId: \"606a0e03450fd22868114e5a\") { user{ _id } blog{ _id } } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### numLikes
- Description:
    - retrieve the number of likes
    - optionally specify userId to retrieve the number of likes made by a specific user
    - optionally specify blogId to retrieve the number of likes on a specific blog
- Parameters:
    - [Optional] userId: (String) Get the number of likes from the specific user with ID :userId
    - [Optional] blogId: (String) Get the number of likes for the specific blog with ID :blogId
- Response:
    - Type: Int
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { numLikes(blogId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### follows
- Description:
    - retrieve at most 20 follows
    - optionally specify followerId to retrieve the follows from a specific user
    - optionally specify followedId to retrieve the follows on a specific user
- Parameters:
    - first: (Int) First :first number of follows, :first <= 20, :first > 0
    - after: (Int) Skip :after number of follows, :after >= 0
    - [Optional] followerId: (String) Get the follows from the specific user with ID :followerId
    - [Optional] followedId: (String) Get the follows on the specific user with ID :followedId
- Response:
    - Type: [Follow]
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { follows(first: 20, after: 0, followedId: \"606a0e03450fd22868114e5a\") { follower{ _id } followed{ _id } } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### numFollows
- Description:
    - retrieve the number of follows
    - optionally specify followerId to retrieve the number of follows from a specific user
    - optionally specify followedId to retrieve the number of follows on a specific user
- Parameters:
    - [Optional] followerId: (String) Get the number of follows from the specific user with ID :followerId
    - [Optional] followedId: (String) Get the number of follows on the specific user with ID :followedId
- Response:
    - Type: Int
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { numFollows(followedId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### world
- Description:
    - retrieve the current world
    - optionally specify long poll to only get the response back when the world updates, or timesout after 10 minutes
- Parameters:
    - [Optional] long: (Boolean) long poll iff true
- Response:
    - Type: World
    - If long is true and long poll times out after 10 mins, null is returned
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"query { world(long: true) { terrain size } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

## Graphql Mutation Endpoints

**Note:** All graphql requests go through /graphql with POST method 

### signup
- Description:
    - sign up a user
- Parameters:
    - email: (String) email of the user, must be unique
    - password: (String) password of the user
    - name: (String) name of the user to be display
- Response:
    - Type: User
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { signup(email: \"test@mail.com\", password: \"password123\", name:\"Test\") { _id } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### updateUserPosition
- Description:
    - update logged-in user's position
- Parameters:
    - position: ([Int]) new position of the logged-in user
- Response:
    - Type: Boolean
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { updateUserPosition(position: [10, 10]) }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### createBlog
- Description:
    - create a new blog
- Parameters:
    - title: (String) Title of the blog
    - content: (String) Content of the blog
    - position: ([Int]) Position of the blog in the world
- Response:
    - Type: Blog
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { createBlog(title:\"Title of the blog\", content: \"Content of the blog\", position: [10, 10]) { _id title content } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### deleteBlog
- Description:
    - delete an existing blog
- Parameters:
    - blogId: (String) ID of the blog to be deleted
- Response:
    - Type: Boolean
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { deleteBlog(blogId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### addComment
- Description:
    - add a new comment
- Parameters:
    - blogId: (String) ID of the blog to add the comment to
    - content: (String) Content of the comment
- Response:
    - Type: Comment
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { addComment(blogId: \"606a0e03450fd22868114e5a\", content: \"content of the comment\") { _id content } }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### deleteComment
- Description:
    - delete an existing comment
- Parameters:
    - commentId: (String) ID of comment to be deleted
- Response:
    - Type: Boolean
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { deleteComment(commentId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### likeBlog
- Description:
    - logged-in user likes a blog
- Parameters:
    - blogId: (String) ID of the blog to be liked
- Response:
    - Type: String
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { likeBlog(blogId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### unlikeBlog
- Description:
    - logged-in user unlikes a blog
- Parameters:
    - blogId: (String) ID of the blog to be unliked
- Response:
    Type: String
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { unlikeBlog(blogId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### followUser
- Description:
    - logged-in user follows a user
- Parameters:
    - userId: (String) ID of the user to be followed
- Response:
    - Type: String
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { followUser(userId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```

### unfollowUser
- Description:
    - logged-in user unfollow a user
- Parameters:
    - userId: (String) ID of the user to be unfollowed
- Response:
    - Type: String
- Example:
    ```
    curl -X POST 'https://glob3d.tk/graphql' \
        -H 'Content-Type: application/json' \
        --data-raw '{"query":"mutation { unfollowUser(userId: \"606a0e03450fd22868114e5a\") }"}' \
        -c cookie.txt \
        -b cookie.txt
    ```